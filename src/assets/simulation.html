<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Force-Directed Layout with Collision and Reduced Crossings</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    svg {
      width: 800px;
      height: 600px;
      border: 1px solid black;
    }
    rect {
      fill: lightblue;
      stroke: black;
      stroke-width: 1px;
    }
  </style>
</head>
<body>
  <svg></svg>
  <script>
    // 1. Initialiser les données
    const nodes = [
      { id: 'A', width: 50, height: 30, toto: "hello" },
      { id: 'B', width: 70, height: 40 },
      { id: 'C', width: 60, height: 50 },
      { id: 'D', width: 80, height: 60 }
    ];

    const links = [
      { source: 'A', target: 'B' },
      { source: 'A', target: 'C' },
      { source: 'B', target: 'D' }
    ];

    // 2. Créer la simulation
    const simulation = d3.forceSimulation(nodes)
      .force('link', d3.forceLink(links).id(d => d.id).distance(150))
      .force('charge', d3.forceManyBody().strength(0))
      .force('center', d3.forceCenter(200, 200))
      .force('collision', d3.forceCollide().radius(d => Math.max(d.width, d.height) / 2 + 10))
      .on('tick', ticked);


    // 3. Créer les éléments SVG pour les nœuds et les liens
    const svg = d3.select('svg');
    const link = svg.selectAll('line')
      .data(links)
      .enter().append('line')
      .attr('stroke', '#999')
      .attr('stroke-width', 2);

    const node = svg.selectAll('rect')
      .data(nodes)
      .enter().append('rect')
      .attr('width', d => d.width)
      .attr('height', d => d.height);

    // 4. Mettre à jour les positions des nœuds et des liens à chaque "tick"
    function ticked() {
      link
        .attr('x1', d => d.source.x + d.source.width / 2)
        .attr('y1', d => d.source.y + d.source.height / 2)
        .attr('x2', d => d.target.x + d.target.width / 2)
        .attr('y2', d => d.target.y + d.target.height / 2);

      node
        .attr('x', d => d.x)
        .attr('y', d => d.y);
    }
  </script>
</body>
</html>
